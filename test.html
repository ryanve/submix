<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <link rel="dns-prefetch" href="//airve.com">
    <title>submix: test suite</title>
    <meta name=viewport content="width=device-width,initial-scale=1.0">
    <meta name=description content="JavaScript test suite for submix.js">
    <meta name=author content="Ryan Van Etten">
    <link rel=stylesheet href="http://airve.com/css/sitewide.201301233.css">
    <style>
        body { width:96%; }
    </style>
</head>
<body>

<h1>
    <a href="http://github.com/ryanve/submix">submix</a>: test suite
</h1>

<main id="main" role="main">
    <p>Open the console to view results.</p>
    <p>View the pagesource to view tests.</p>
</main>

<script src="http://airve.github.io/js/aok/aok.min.js"></script>
<script src="http://airve.github.io/js/dj/dj.min.js"></script>
<script src="http://airve.github.io/js/elo/elo.min.js"></script>
<script src="http://airve.github.io/js/vibe/vibe.min.js"></script>
<script src="submix.js"></script>
<script>
    (function(document, aok, submix, vibe, elo) {
        var bridge = submix.bridge
          , tracks = submix.tracks;

        function noop() {}
        function stop() { 
            return false; 
        }
        function two() { 
            return 2; 
        }
        // aok.log(submix);
        // aok.log(bridge({}))
        // aok.log(submix.call({ fn: {} }, aok, vibe, elo ));
        // aok.log(submix.submix(elo, vibe, false));
        aok({
            id: 'syncs'
          , test: submix === submix.submix 
        });
        aok({
            id: 'types'
          , test: typeof submix == 'function' && typeof bridge == 'function' 
        });
        aok({
            id: 'protectGlobe'
          , test: function() {
                var globe = window, a = globe.a, bool;
                return elo.each([tracks, submix], function(method) {
                    return bool = (
                        globe !== method.call(null, { a: 1 })
                     && globe !== method.call(globe, { a: 1 })
                     && globe !== method.call(globe, { a: 1 }, true)
                     && 1 === method.call(globe, { a: 1 }, true).a
                     && '[object Object]' === method.call(globe, { a: 1 }).toString()
                    );
                }), bool && a === globe.a; 
            }
        });
        aok({
            id: 'forcePrecision'
          , test: function() {
                return (
                    // should overwrite only if it is "function" or 3qual to `true`
                    1 === bridge.call({ a: 1 }, { a: 2 }, true).a
                 && 2 === bridge.call({ a: 1 }, { a: 2 }, false).a
                 && 2 === bridge.call({ a: 1 }, { a: 2 }, {}).a
                 && 2 === bridge.call({ a: 1 }, { a: 2 }, 1).a
                 && 2 === bridge.call({ a: 1 }, { a: 2 }, null).a
                );
            }
        });
        aok({
            id: 'sendParamFires'
          , test: function() {
                var bool = false;
                return bridge.call({ a: 1 }, { a: 2 }, function() {
                    bool = true;
                }), bool;
            }
        });
        aok({
            id: 'sendParamDefers'
          , test: function() {
                return 1 === (bridge.call({ a: 1 }, {}, noop)).a;
            }
        });
        aok({
            id: 'sendParamForces'
          , test: function() {
                return 1 === bridge.call({ a: 1 }, { a: 2 }, noop).a;
            }
        });
        aok({
            id: 'sendParamStops'
          , test: function() {
                return 2 === bridge.call({ a: 1 }, { a: 2 }, stop).a;
            }
        });
        aok({
            id: 'sendParamCustomizes'
          , test: function() {
                return 2 === bridge.call({ a: 1 }, {}, two).a;
            }
        });
        aok({
            id: 'sendPropDefers'
          , test: function() {
                return 1 === bridge.call({
                    a: { send: noop } 
                }, { a: 1 }).a;
            }
        });
        aok({
            id: 'sendPropStops'
          , test: function() {
                return 2 === bridge.call({
                    a: { send: stop } 
                }, { a: 2 }).a;
            }
        });
        aok({
            id: 'sendPropCertifies'
          , test: function() {
                var o = { send: true };
                return o === bridge.call({
                    a: o
                }, {}).a;
            }
        });
        aok({
            id: 'sendPropCustomizes'
          , test: function() {
                return 2 === bridge.call({
                    a: { send: two } 
                }, {}).a;
            }
        });
        aok({
            id: 'customBridge'
          , test: function() {
                var e = {}, o = {}, c = {}, s;
                function valid(r, send, $) {
                    return r === c && s === this && c;
                }
                // To be valid as custom, its "send" must 3qual `false`
                // Otherwise the standard bridge is used.
                valid['send'] = false;
                function invalid() {}
                s = { bridge: valid };
                return c === bridge.call(s, c) && e === bridge.call({
                    bridge: invalid
                }, e);
            }
        });
        aok({
            id: 'tracksSansOptions'
          , test: function() {
                // It should force overwrite by default.
                return (
                    2 === tracks({ a: 1 }, { a: 2 }).a
                 && 2 === tracks.call({ a: 1 }, { a: 2 }).a
                 && 3 === tracks({ a: 1 }, { a: 2 }, { a: 3 }).a
                );
            }
        });
        aok({
            id: 'tracksWithOptions'
          , test: function() {
                return (
                    1 === tracks({ a: 1 }, { a: 2 }, { a: 3 }, false).a
                 && 1 === tracks.call({ a: 1 }, { a: 2 }, false).a
                 && 2 === tracks.call({ a: 1 }, { a: 2 }, { a: 3 }, false).a
                 && 1 === tracks({ a: 1 }, { a: 2 }, { a: 3 }, false, noop).a
                 && 3 === tracks({ a: 1 }, { a: 2 }, { a: 3 }, true).a
                 && 3 === tracks({ a: 1 }, { a: 2 }, { a: 3 }, true, noop).a
                );
            }
        });
    }(document, aok, submix, vibe, elo));
</script>
</body>
</html>